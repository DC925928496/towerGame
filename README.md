# 爬塔游戏 - Tower Climbing Game

## 🎯 项目概述

一个基于Web的单人回合制Roguelike爬塔游戏，目标是从第1层爬到第100层并击败最终Boss。

- **游戏类型**：回合制Roguelike爬塔
- **技术栈**：Python (WebSocket) + HTML5 Canvas
- **架构**：MVC模式，前后端分离
- **设计理念**：KISS原则，简单可维护

---

## 🎮 核心游戏机制

### 1. 回合制战斗系统
- **伤害公式**：`伤害 = max(1, 攻击力 - 防御力)`
- **战斗流程**：玩家先攻击 → 怪物反击（存活时）
- **战斗奖励**：经验值 + 金币，用于升级和购买

### 2. 怪物威胁区域系统 ⭐
- **威胁范围**：怪物周围3格（曼哈顿距离≤3）
- **战略限制**：威胁区域内道具/楼梯无法使用
- **战术影响**：必须先击败威胁怪物才能获得重要资源

### 3. 商人楼层系统 🆕
- **触发机制**：
  - 第1-9层：固定普通楼层
  - 第10层：固定商人楼层（保证第一次机会）
  - 第11层起：每10层20%基础概率，失败递增5%
- **交易功能**：只能购买（药水、武器、防具）
- **动态定价**：基础价格10 + 楼层×5
- **操作方式**：按`0`键打开交易界面

### 4. 装备与道具系统
- **血瓶**：回复生命值，背包存储
- **武器/防具**：替换装备，旧装备自动掉落
- **装备掉落**：更换时旧装备落在当前位置，可重新拾取

### 5. 自动交互系统
- **无键操作**：移动到目标位置自动触发
- **自动拾取**：走到道具位置自动拾取（无威胁时）
- **自动上楼**：走到楼梯位置自动进入下一层（无威胁时）

### 6. 随机地图生成
- **地图规格**：15×15网格，房间+走廊布局
- **房间数量**：每层4-6个随机房间
- **难度递增**：怪物属性和道具效果随楼层指数增长

---

## 🛠️ 技术架构

### 后端架构
```
towerGame/
├── game_model.py      # 数据模型（玩家、怪物、地图、商人）
├── game_logic.py      # 游戏逻辑（战斗、交互、交易）
├── game_server.py     # WebSocket服务器和状态管理
├── map_generator.py   # 地图生成系统
├── save_load.py      # 存档系统
├── utils/            # 工具类模块
├── config/           # 配置管理
└── index.html        # 前端界面
```

### 技术特点
- **轻量级**：仅需`websockets`库，纯Python标准库
- **实时通信**：WebSocket双向JSON消息传递
- **模块化**：清晰架构分离，便于维护
- **配置驱动**：游戏参数集中管理

---

## 🚀 快速开始

### 环境准备
```bash
# 安装依赖
pip install websockets
```

### 启动服务器
```bash
cd /path/to/towerGame
python game_server.py
```
服务器将在 `ws://localhost:8080` 启动

### 开始游戏
在浏览器中打开 `index.html` 即可开始游戏

---

## 🎮 游戏操作

### 移动控制
- **方向键**：↑↓←→ 或 WASD
- **道具使用**：数字键 1-9 对应背包位置
- **商人交易**：按 `0` 键打开商人界面（仅在商人楼层）

### 自动交互
- **智能拾取**：走到道具位置自动拾取
- **智能上楼**：走到楼梯位置自动进入下一层
- **威胁检测**：自动检测怪物威胁，限制道具使用

---

## 📊 游戏数据系统

### 玩家属性
- **初始**：HP 500/500, 攻击力 50, 防御力 20
- **成长**：击败怪物获得经验值和金币
- **装备系统**：武器攻击力 + 防具防御力加成

### 成长公式（第N层）
- **怪物生命**：80 + N × 20 (±20%随机)
- **怪物攻击**：25 + N × 5 (±20%随机)
- **道具效果**：血瓶回复量、武器攻击力、防具防御力随楼层提升

### 商人定价机制
- **基础价格**：10 + 楼层 × 5 金币
- **商品类型**：
  - 血瓶：回复 50 + 楼层 × 20 HP
  - 武器：攻击 + 楼层 × 5
  - 防具：防御 + 楼层 × 3

---

## 🏆 游戏目标

### 胜利条件
到达第100层并击败最终Boss（死亡骑士）

### Boss属性
- **生命值**：5000
- **攻击力**：800
- **防御力**：200

### 失败条件
玩家生命值降至0（被怪物击败）

---

## 🎯 核心特色

⭐ **怪物威胁区域系统**：战术深度与策略规划
⭐ **商人楼层系统**：经济系统与装备强化
⭐ **自动交互系统**：流畅的游戏体验
⭐ **智能重生系统**：避免位置异常
⭐ **配置化管理**：游戏参数灵活调整

---

## 🔧 开发与维护

### 代码规范
- 遵循KISS原则，保持代码简洁
- 完善的类型注解和函数文档
- 模块化设计，便于功能扩展

### 测试方法
```bash
# 编译测试
python -m py_compile *.py utils/*.py config/*.py
```

### 版本信息
**当前版本：v1.4**
- 商人楼层系统
- 优化游戏体验
- 完善文档结构

---

## 📄 许可证

MIT License - 可自由使用、修改和分发

---

*核心特色：怪物威胁区域 + 商人楼层系统*
*版本：v1.4 - 优化体验与完善文档*